

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="X-UA-Compatible" content="IE=edge">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@JinaAI_">
<meta name="twitter:creator" content="@JinaAI_">
<meta name="description"
      content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:title" content="Jina Documentation">
<meta property="og:description"
      content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:url" content="https://opensource.jina.ai">
<meta property="og:image" content="../../_static/banner.png">
<meta property="og:type" content="website">
<link rel="icon" href="../../_static/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Recursive Document Representation &mdash; Jina 2.0.0rc5 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/main.css" type="text/css" />


  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Executors and How to Use Them" href="../executors/" />
    <link rel="prev" title="MIME Types" href="../mime-type/" /> 
</head>

<body class="wy-body-for-nav">
  <div id="showhide-navbar-btn" onclick="showhide_navbar();"></div>

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://docs.jina.ai">
          

          
            
            <img src="../../_static/jina-prod-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            

          <div class="dropdown version">
            <button class="dropbtn version">2.0.0rc5</button>
            <div class="dropdown-content">
              
              <a class="dropdown-item" href="/master">master</a>
              
              <a class="dropdown-item" href="/v1.3.0">1.3.0</a>
              
              <a class="dropdown-item" href="/v1.2.4">1.2.4</a>
              
              <a class="dropdown-item" href="/v1.2.2">1.2.2</a>
              
              <a class="dropdown-item" href="/v1.2.1">1.2.1</a>
              
              <a class="dropdown-item" href="/v1.1.9">1.1.9</a>
              
              <a class="dropdown-item" href="/v1.1.8">1.1.8</a>
              
              <a class="dropdown-item" href="/v1.1.7">1.1.7</a>
              
              <a class="dropdown-item" href="/v1.1.6">1.1.6</a>
              
              <a class="dropdown-item" href="/v1.1.5">1.1.5</a>
              
              <a class="dropdown-item" href="/v1.1.4">1.1.4</a>
              
              <a class="dropdown-item" href="/v1.1.3">1.1.3</a>
              
              <a class="dropdown-item" href="/v1.1.2">1.1.2</a>
              
              <a class="dropdown-item" href="/v1.1.1">1.1.1</a>
              
              <a class="dropdown-item" href="/v1.1.0">1.1.0</a>
              
              <a class="dropdown-item" href="/v1.0.9">1.0.9</a>
              
              <a class="dropdown-item" href="/v1.0.7">1.0.7</a>
              
              <a class="dropdown-item" href="/v1.0.6">1.0.6</a>
              
              <a class="dropdown-item" href="/v1.0.5">1.0.5</a>
              
              <a class="dropdown-item" href="/v1.0.4">1.0.4</a>
              
              <a class="dropdown-item" href="/v1.0.3">1.0.3</a>
              
              <a class="dropdown-item" href="/v1.0.2">1.0.2</a>
              
              <a class="dropdown-item" href="/v1.0.1">1.0.1</a>
              
              <a class="dropdown-item" href="/v1.0.0">1.0.0</a>
              
              <a class="dropdown-item" href="/v0.9.8">0.9.8</a>
              
              <a class="dropdown-item" href="/v0.9.7">0.9.7</a>
              
              <a class="dropdown-item" href="/v0.9.6">0.9.6</a>
              
              <a class="dropdown-item" href="/v0.9.5">0.9.5</a>
              
              <a class="dropdown-item" href="/v0.9.4">0.9.4</a>
              
              <a class="dropdown-item" href="/v0.9.34">0.9.34</a>
              
              <a class="dropdown-item" href="/v0.9.33">0.9.33</a>
              
              <a class="dropdown-item" href="/v0.9.3">0.9.3</a>
              
              <a class="dropdown-item" href="/v0.9.28">0.9.28</a>
              
              <a class="dropdown-item" href="/v0.9.23">0.9.23</a>
              
              <a class="dropdown-item" href="/v0.9.22">0.9.22</a>
              
              <a class="dropdown-item" href="/v0.9.21">0.9.21</a>
              
              <a class="dropdown-item" href="/v0.9.20">0.9.20</a>
              
              <a class="dropdown-item" href="/v0.9.19">0.9.19</a>
              
              <a class="dropdown-item" href="/v0.9.18">0.9.18</a>
              
              <a class="dropdown-item" href="/v0.9.17">0.9.17</a>
              
              <a class="dropdown-item" href="/v0.9.16">0.9.16</a>
              
              <a class="dropdown-item" href="/v0.9.15">0.9.15</a>
              
              <a class="dropdown-item" href="/v0.9.14">0.9.14</a>
              
              <a class="dropdown-item" href="/v0.9.13">0.9.13</a>
              
              <a class="dropdown-item" href="/v0.9.12">0.9.12</a>
              
              <a class="dropdown-item" href="/v0.9.11">0.9.11</a>
              
              <a class="dropdown-item" href="/v0.9.10">0.9.10</a>
              
              <a class="dropdown-item" href="/v0.9.9">0.9.9</a>
              
              <a class="dropdown-item" href="/v0.9.8">0.9.8</a>
              
              <a class="dropdown-item" href="/v0.9.7">0.9.7</a>
              
              <a class="dropdown-item" href="/v0.9.6">0.9.6</a>
              
              <a class="dropdown-item" href="/v0.9.5">0.9.5</a>
              
              <a class="dropdown-item" href="/v0.9.3">0.9.3</a>
              
              <a class="dropdown-item" href="/v0.9.2">0.9.2</a>
              
              <a class="dropdown-item" href="/v0.9.1">0.9.1</a>
              
              <a class="dropdown-item" href="/v0.9.0">0.9.0</a>
              
              <a class="dropdown-item" href="/v0.8.22">0.8.22</a>
              
              <a class="dropdown-item" href="/v0.8.21">0.8.21</a>
              
            </div>
          </div>
            
          


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Jina Core</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../core/guides/">Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../core/setup/">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../my_first_jina_app/">Building Your First Jina App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/ide-speedup/">Speeding Up Development in PyCharm and VSCode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../primitive_data_type/">Primitive Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mime-type/">MIME Types</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Recursive Document Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../executors/">Processing Documents with Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simple_exec/">Built-in Simple Executors and Reserved <code class="docutils literal notranslate"><span class="pre">uses</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../extend/executor/">Adding New Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peas-and-pods/">Peas and Pods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extend/driver/">Adding New Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow/">Composing a Search Workflow with the Flow API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input_output/">Inputs and Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crud/">CRUD Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cross_multi_modality/">Multi-modal and Cross-modal Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sparse/">Using Sparse Embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/">Configuring Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/exit/">Exiting a Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dump-reload/">Rolling Updates and Query While Indexing in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../evaluation/">Evaluating a Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization/">Optimizing a Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ranker/">Ranking Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ranker_trainer/">A guide on Jina Ranker Trainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../prevent_duplicate_indexing/">Preventing Duplicate Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incremental_indexing/">Incremental Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parallel/">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../batching/">Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../request_size/">Request Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="../remote/">Distributing Jina Remotely</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stress/">Cloud Benchmark &amp; Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../envs/">OS Environment Variables Used in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow/pattern/">Common Design Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../autocomplete/">Autocomplete commands on Bash, Zsh and Fish</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../core/api_references/">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Dashboard</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dashboard/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dashboard/guides/">Developer Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Hub</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hub/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hub/guides/">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hub/api_references/">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Box</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../box/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../box/guides/">Developer Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary/">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">Contributing to Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/#join-us-on-slack">Join Us on Slack!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE/">Release &amp; Version Identifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">Change Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jep/">Jina Enhancement Proposals (JEP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/dev/">FAQ for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/user/">FAQ for End-Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docstring/">Docstring Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Indices and Tables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../all_exec/">List of 123 Executors in Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../all_driver/">List of 62 Drivers in Jina</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Jina</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation" class="nav-bar-header">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../core/guides/">Developer Guides</a> &raquo;</li>
        
      <li>Recursive Document Representation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  
<div role="search" class="nav-bar-search">
  <form id="rtd-search-form" class="wy-form doc-searchbox" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs (Press / to focus)" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

</div>
<hr/>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="recursive-document-representation">
<h1>Recursive Document Representation<a class="headerlink" href="#recursive-document-representation" title="Permalink to this headline">¶</a></h1>
<p>This guide explains how Documents are represented within the Jina framework. It is especially relevant for understanding how segmenters, crafters and rankers work.</p>
<div class="section" id="general-overview">
<h2>General overview<a class="headerlink" href="#general-overview" title="Permalink to this headline">¶</a></h2>
<p>In Jina, the term Document refers to more than just a simple representation of datasets. A Document is used for both indexing and querying. A search query is also a Document itself.</p>
<p>When you index a Document in Jina, it can be represented as a rooted recursive representation (tree). The representation consists of a <em>root node</em> and several <em>child nodes</em>. In Jina, the root node is the original Document itself, while the <em>left</em> and <em>right</em> children are referred to as <em>chunks</em> and <em>matches</em> respectively. The figure below illustrates a basic Document structure that consists of a Document (root node) as well as two child nodes (chunks and matches).</p>
<p><img alt="rooted-binary-tree" src="../../_images/overview.png" /></p>
<p>The two terms chunks and sequence require further explanation. In short, chunks are a sequence of Documents which can be attached to any parent Document with a higher <code class="docutils literal notranslate"><span class="pre">granularity</span></code> degree. In the figure above this is the root node.</p>
<p>Similarly, this applies to <code class="docutils literal notranslate"><span class="pre">matches</span></code>. <code class="docutils literal notranslate"><span class="pre">matches</span></code> is a sequence of Documents which are semantically related to the higer-level Document (the root node in the figure above). We will dive into these concepts in more detail below.</p>
<ul class="simple">
<li><p><a class="reference external" href="#chunks">Chunks</a></p></li>
<li><p><a class="reference external" href="#matches">Matches</a></p></li>
<li><p><a class="reference external" href="#lets-go-deeper-recursive-document-representation">Let’s go deeper: Recursive Document Representation</a></p></li>
<li><p><a class="reference external" href="#document-traversal-with-traversal-paths">Document Traversal with traversal paths</a></p></li>
</ul>
</div>
<div class="section" id="chunks">
<h2>Chunks<a class="headerlink" href="#chunks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="understanding-chunks">
<h3>Understanding chunks<a class="headerlink" href="#understanding-chunks" title="Permalink to this headline">¶</a></h3>
<p>Each Jina Document (potentially) consists of a list of <em>chunks</em>. A single chunk is a small semantic unit of a Document, like a sentence, a 64x64 pixel image patch or a video sequence. You identify each chunk uniquely via an id called <code class="docutils literal notranslate"><span class="pre">chunk_id</span></code>.</p>
<p>In practice, all chunks for text data will not neccesarily have the same size – some sentences are short, and others rather long. For regularly divided images it can be different – a 256x256 pixel image can be split into a patches of 64x64 pixel that all have the same size.</p>
<p>A chunk also allows you to search for a section of the Document, for example an image followed by a paragraph of text. These are use cases that are more common than you might think.</p>
<p>Following the definition of <a class="reference external" href="primitive_data_type.rst">primitive data types in Jina</a>, a chunk is a property of a Document:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="k">with</span> <span class="n">Document</span><span class="p">()</span> <span class="k">as</span> <span class="n">root</span><span class="p">:</span>
    <span class="n">root</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;What is love? Oh baby do not hurt me.&#39;</span>

<span class="c1"># Initialised a Document as root with zero chunks.</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">chunks</span><span class="p">))</span>                <span class="c1"># outputs 0</span>

<span class="c1"># Initialise two Documents and add them as chunks to root.</span>
<span class="k">with</span> <span class="n">Document</span><span class="p">()</span> <span class="k">as</span> <span class="n">chunk1</span><span class="p">:</span>
    <span class="n">chunk1</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;What is love?&#39;</span>
    <span class="n">root</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk1</span><span class="p">)</span>
<span class="k">with</span> <span class="n">Document</span><span class="p">()</span> <span class="k">as</span> <span class="n">chunk2</span><span class="p">:</span>
    <span class="n">chunk2</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Oh baby do not hurt me.&#39;</span>
    <span class="n">root</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk2</span><span class="p">)</span>

<span class="c1"># Now the Document has two chunks</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">chunks</span><span class="p">))</span>                <span class="c1"># outputs 2</span>
</pre></div>
</div>
</div>
<div class="section" id="internals-adding-a-chunk-to-a-root-node">
<h3>Internals: Adding a chunk to a root node<a class="headerlink" href="#internals-adding-a-chunk-to-a-root-node" title="Permalink to this headline">¶</a></h3>
<p>Now let us have a look at what happens when you added a chunk to a root node. The code example below shows the granularity level of a specific node using the attribute <code class="docutils literal notranslate"><span class="pre">granularity</span></code> – as a root node (level 0), and as a chunk (level 1).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">granularity</span><span class="p">)</span>                <span class="c1"># outputs 0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">granularity</span><span class="p">)</span>      <span class="c1"># outputs 1</span>
</pre></div>
</div>
<p>This is illustrated in the image below:</p>
<p><img alt="granularity" src="../../_images/granularity.png" /></p>
<p>Furthermore, with the help of the attribute <code class="docutils literal notranslate"><span class="pre">parent_id</span></code> , the relation between the root node and the chunk can be validated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">root</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span>  <span class="c1"># outputs True</span>
</pre></div>
</div>
<p>The code sample and graph above demonstrates the basic idea of a <code class="docutils literal notranslate"><span class="pre">chunk</span></code> in a Document. At the beginning, by default a Document is initialised with <code class="docutils literal notranslate"><span class="pre">granularity</span> <span class="pre">=</span> <span class="pre">0</span></code>. Next, two chunks have been initialised with <code class="docutils literal notranslate"><span class="pre">granularity</span> <span class="pre">=</span> <span class="pre">0</span></code>, and have been added to the root node. On addition of a chunk to a node, two things happen:</p>
<ol class="simple">
<li><p>The granularity of the chunk will be increased by 1.</p></li>
<li><p>The chunk will be referenced to its parent which is the root node.</p></li>
</ol>
<p>This procedure allows Jina (and you) to query chunks and reference them back to its root Document at any <code class="docutils literal notranslate"><span class="pre">granularity</span></code> level.</p>
</div>
</div>
<div class="section" id="matches">
<h2>Matches<a class="headerlink" href="#matches" title="Permalink to this headline">¶</a></h2>
<p>In a neural search system (and traditional retrieval system), <em>matches</em> are the expected Documents returned from the search index for the user query. In Jina, matches could happen at any level of the representation tree – the root level or any chunk level.</p>
<p>To fully understand the concept of matches, we introduce a new term, named <em>adjacency</em> (short for <em>a</em> in the diagram below). The adjacency reflects the level of the Document it is connected to.</p>
<p><strong>NOTE: granularity and adjacency apply to both chunks and matches.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Document</span>

<span class="k">with</span> <span class="n">Document</span><span class="p">()</span> <span class="k">as</span> <span class="n">root</span><span class="p">:</span>
    <span class="n">root</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;What is love? Oh baby do not hurt me.&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">adjacency</span><span class="p">)</span>                  <span class="c1"># outputs 0</span>

<span class="c1"># Initialise two Documents and add as chunks to root.</span>
<span class="k">with</span> <span class="n">Document</span><span class="p">()</span> <span class="k">as</span> <span class="n">chunk1</span><span class="p">:</span>
    <span class="n">chunk1</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;What is love?&#39;</span>
    <span class="n">root</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk1</span><span class="p">)</span>
<span class="k">with</span> <span class="n">Document</span><span class="p">()</span> <span class="k">as</span> <span class="n">chunk2</span><span class="p">:</span>
    <span class="n">chunk2</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Oh baby do not hurt me.&#39;</span>
    <span class="n">root</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk2</span><span class="p">)</span>

<span class="c1"># Add a match Document.</span>
<span class="k">with</span> <span class="n">Document</span><span class="p">()</span> <span class="k">as</span> <span class="n">match</span><span class="p">:</span>
    <span class="c1"># a match Document semantically related to our root</span>
    <span class="n">match</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;What is love? Oh please do not hurt me.&#39;</span>
    <span class="n">root</span><span class="o">.</span><span class="n">matchesa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">matches</span><span class="p">))</span>               <span class="c1"># outputs 1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">granularity</span><span class="p">)</span>     <span class="c1"># outputs 0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">adjacency</span><span class="p">)</span>       <span class="c1"># outputs 1</span>
</pre></div>
</div>
<p><img alt="adjacency" src="../../_images/adjacency.png" /></p>
<p>In the code snippet and diagram above, we initialized a Document as <code class="docutils literal notranslate"><span class="pre">root</span></code> with the text: <em>What is love? Oh, baby do not hurt me.</em>. Next, a Document with the text <em>What is love? Oh please do not hurt me</em> was added as a match to the <code class="docutils literal notranslate"><span class="pre">root</span></code> node. The matched Document <code class="docutils literal notranslate"><span class="pre">match</span></code> is a Document without any parents, so it stays at the same level as the <code class="docutils literal notranslate"><span class="pre">root</span></code> node with a granularity value of 0. Meanwhile, since <code class="docutils literal notranslate"><span class="pre">match</span></code> is the retrieved result from the <code class="docutils literal notranslate"><span class="pre">root</span></code> node, so the <code class="docutils literal notranslate"><span class="pre">adjacency</span></code> increased to 1.</p>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">root</span></code> node has an <code class="docutils literal notranslate"><span class="pre">adjacency</span></code> of 0. The value increases by 1 when it hits a <code class="docutils literal notranslate"><span class="pre">match</span></code>.</p>
</div>
<div class="section" id="let-s-go-deeper-recursive-document-representation">
<h2>Let’s go deeper: Recursive Document Representation<a class="headerlink" href="#let-s-go-deeper-recursive-document-representation" title="Permalink to this headline">¶</a></h2>
<p>So far we have only discussed <code class="docutils literal notranslate"><span class="pre">chunks</span></code> and <code class="docutils literal notranslate"><span class="pre">matches</span></code> <strong>with a depth of 1</strong>. While in a real-world scenario, things could be much more complicated than this. For instance, a <code class="docutils literal notranslate"><span class="pre">chunk</span></code> could be further divided into smaller chunks, and a chunk at any level might have its own <code class="docutils literal notranslate"><span class="pre">matches</span></code> at that level.</p>
<p><img alt="go-deeper" src="https://hanxiao.io/2020/08/28/What-s-New-in-Jina-v0-5/blog-post-v050-protobuf-documents.jpg" /></p>
<p>Jina has defined a recursive structure with <strong>arbitrary width and depth</strong> instead of a trivial bi-level structure. Roughly speaking, chunks can have the next level chunks and the same level matches; and so do matches. This could go on and on. The following figure illustrates this structure <a class="reference external" href="https://hanxiao.io/2020/08/28/What-s-New-in-Jina-v0-5/">Ref: New Features in Jina v0.5 You Should Know About</a>.</p>
<p><img alt="recursive" src="../../_images/recursive.png" /></p>
<p>This recursive structure provides Jina the flexibility to cover any complex use case that may require search at different semantic units. Besides that, the recursive structure enables Jina rankers to accumulate scores from lower granularities to upper granularities, such as <code class="docutils literal notranslate"><span class="pre">Chunk2DocRankers</span></code>. For example, in NLP a long Document is composed of semantic chapters; each chapter consists of multiple paragraphs, which can be further segmented into sentences. In CV, a video is composed of one or more scenes, including one or more shots (i.e. a sequence of frames taken by a single camera over a continuous period of time). Each shot includes one or more frames.</p>
<p>Such hierarchical structures can be very well represented with the recursive representation. The image below shows the tree view (with a depth of 3):</p>
<p><img alt="tree-view" src="../../_images/tree.png" /></p>
</div>
<div class="section" id="document-traversal-with-traversal-paths">
<h2>Document traversal with traversal paths<a class="headerlink" href="#document-traversal-with-traversal-paths" title="Permalink to this headline">¶</a></h2>
<p>As you have already learned from <a class="reference external" href="https://101.jina.ai">Jina 101</a>, you need to apply transformation (i.e. a <code class="docutils literal notranslate"><span class="pre">callback</span></code>) on a different level of Documents. Given the tree structure, how could we achieve that? The answer is <code class="docutils literal notranslate"><span class="pre">traversal</span></code>.</p>
<p>Jina has defined a method called <code class="docutils literal notranslate"><span class="pre">traversal()</span></code> within the class of a Document. The method looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traversal_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callback_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;Traversal apply `:meth:callback_fn` on the recursive tree representation.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This allows you to apply a callback function named <code class="docutils literal notranslate"><span class="pre">callback_fn()</span></code> based on <code class="docutils literal notranslate"><span class="pre">traversal_path</span></code>. The <code class="docutils literal notranslate"><span class="pre">traversal_path</span></code> is defined as shown below:</p>
<p><img alt="nodes" src="../../_images/nodes.png" /></p>
<p>With these pre-defined node names, you are able to apply any callbacks (defined as <code class="docutils literal notranslate"><span class="pre">_apply_all</span></code> in the <code class="docutils literal notranslate"><span class="pre">driver</span></code>) to a specific node. In the YAML configuration below, the <code class="docutils literal notranslate"><span class="pre">VectorSearchDriver</span></code> was applied to node <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">KVSearchDriver</span></code> was applied to node <code class="docutils literal notranslate"><span class="pre">cm</span></code> (matches of chunks).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="kt">!CompoundIndexer</span>
<span class="nn">...</span>
<span class="nt">requests</span><span class="p">:</span>
  <span class="nt">on</span><span class="p">:</span>
    <span class="nt">SearchRequest</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="kt">!VectorSearchDriver</span>
        <span class="nt">with</span><span class="p">:</span>
          <span class="nt">traversal_path</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;c&#39;</span><span class="p p-Indicator">]</span>
      <span class="p p-Indicator">-</span> <span class="kt">!KVSearchDriver</span>
        <span class="nt">with</span><span class="p">:</span>
          <span class="nt">traversal_path</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;cm&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>The two drivers will be applied sequentially, so the first one applies <code class="docutils literal notranslate"><span class="pre">VectorSearchDriver</span></code> for the indexer. This step helps to get matches for chunks (cm), and add them. The matches for the chunks will contain the scores and the id of the Document. Then, <code class="docutils literal notranslate"><span class="pre">KVSearchDriver</span></code> will be applied at matches of chunks (cm) in order to get the embeddings for <code class="docutils literal notranslate"><span class="pre">cm</span></code> via the id of the analysed Document.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        
        <a href="../executors/" class="btn btn-neutral float-right" title="Executors and How to Use Them"
           accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
        
        
        <a href="../mime-type/" class="btn btn-neutral float-left" title="MIME Types"
           accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
        
    </div>
    

    <hr/>

    <div role="contentinfo">
        <nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">

            <ul class="devsite-footer-linkboxes-list">

                <li class="devsite-footer-linkbox ">
                    <h3 class="devsite-footer-linkbox-heading no-link">Stay connected</h3>
                    <ul class="devsite-footer-linkbox-list">

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">

                                <i class="fab fa-github"></i> GitHub

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://www.linkedin.com/company/jinaai/" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">

                                <i class="fab fa-linkedin"></i> LinkedIn

                            </a>

                        </li>



                        <li class="devsite-footer-linkbox-item">

                            <a href="https://twitter.com/JinaAI_" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">

                                <i class="fab fa-twitter"></i> Twitter

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://www.youtube.com/c/JinaAI" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">

                                <i class="fab fa-youtube"></i> YouTube

                            </a>

                        </li>

                    </ul>
                </li>

                <li class="devsite-footer-linkbox ">
                    <h3 class="devsite-footer-linkbox-heading no-link">Support</h3>
                    <ul class="devsite-footer-linkbox-list">
                        <li class="devsite-footer-linkbox-item">

                            <a href="https://slack.jina.ai"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">

                                <i class="fab fa-slack"></i> Slack community

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina/issues"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">

                                Issue tracker

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina/blob/master/CHANGELOG.md"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">

                                Release notes

                            </a>

                        </li>



                        <li class="devsite-footer-linkbox-item">

                            <a href="https://career.jina.ai"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">

                                Career@Jina AI

                            </a>

                        </li>


                    </ul>
                </li>

            </ul>

        </nav>
        <p>
            
            &copy; Copyright Jina AI Limited. All rights reserved.
            <span class="lastupdated">
        Last updated on Jun 10, 2021.
      </span>

        </p>
    </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });

      function showhide_navbar() {
      var x = document.getElementsByClassName("wy-nav-side")[0];
      var y = document.getElementsByClassName("wy-nav-content-wrap")[0];
      var z = document.getElementById("showhide-navbar-btn");
      if (x.style.display === "none") {
        x.style.display = "block";
        y.style.marginLeft = "300px";
        z.style.left = "300px";
      } else {
        x.style.display = "none";
        y.style.marginLeft = "0";
        z.style.left = "0px";
      }
    }

  </script>

  <!-- Search box becomes active when you press the slash(/) key anywhere on the page-->
  <script>
    const body = document.querySelector('body');
    const searchBox = document.querySelector('form').querySelector('input[type="text"]');

    body.addEventListener('keyup', event => {
      event.preventDefault()
      if (event.key === '/') {
        searchBox.focus();
      }
    });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-164627626-3', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>