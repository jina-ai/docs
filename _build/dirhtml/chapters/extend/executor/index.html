

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  <meta content="Development Guide: Add new Executors" name="description" />
<meta content="Jina, executor, model integration" name="keywords" />

  <meta name="X-UA-Compatible" content="IE=edge">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@JinaAI_">
<meta name="twitter:creator" content="@JinaAI_">
<meta name="description"
      content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:title" content="Jina Documentation">
<meta property="og:description"
      content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:url" content="https://opensource.jina.ai">
<meta property="og:image" content="../../../_static/banner.png">
<meta property="og:type" content="website">
<link rel="icon" href="../../../_static/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Adding New Executors &mdash; Jina 2.0.0rc5 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/main.css" type="text/css" />


  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="Peas and Pods" href="../../peas-and-pods/" />
    <link rel="prev" title="Built-in Simple Executors and Reserved uses" href="../../simple_exec/" /> 
</head>

<body class="wy-body-for-nav">
  <div id="showhide-navbar-btn" onclick="showhide_navbar();"></div>

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://docs.jina.ai">
          

          
            
            <img src="../../../_static/jina-prod-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            

          <div class="dropdown version">
            <button class="dropbtn version">2.0.0rc5</button>
            <div class="dropdown-content">
              
              <a class="dropdown-item" href="/master">master</a>
              
              <a class="dropdown-item" href="/v1.3.0">1.3.0</a>
              
              <a class="dropdown-item" href="/v1.2.4">1.2.4</a>
              
              <a class="dropdown-item" href="/v1.2.2">1.2.2</a>
              
              <a class="dropdown-item" href="/v1.2.1">1.2.1</a>
              
              <a class="dropdown-item" href="/v1.1.9">1.1.9</a>
              
              <a class="dropdown-item" href="/v1.1.8">1.1.8</a>
              
              <a class="dropdown-item" href="/v1.1.7">1.1.7</a>
              
              <a class="dropdown-item" href="/v1.1.6">1.1.6</a>
              
              <a class="dropdown-item" href="/v1.1.5">1.1.5</a>
              
              <a class="dropdown-item" href="/v1.1.4">1.1.4</a>
              
              <a class="dropdown-item" href="/v1.1.3">1.1.3</a>
              
              <a class="dropdown-item" href="/v1.1.2">1.1.2</a>
              
              <a class="dropdown-item" href="/v1.1.1">1.1.1</a>
              
              <a class="dropdown-item" href="/v1.1.0">1.1.0</a>
              
              <a class="dropdown-item" href="/v1.0.9">1.0.9</a>
              
              <a class="dropdown-item" href="/v1.0.7">1.0.7</a>
              
              <a class="dropdown-item" href="/v1.0.6">1.0.6</a>
              
              <a class="dropdown-item" href="/v1.0.5">1.0.5</a>
              
              <a class="dropdown-item" href="/v1.0.4">1.0.4</a>
              
              <a class="dropdown-item" href="/v1.0.3">1.0.3</a>
              
              <a class="dropdown-item" href="/v1.0.2">1.0.2</a>
              
              <a class="dropdown-item" href="/v1.0.1">1.0.1</a>
              
              <a class="dropdown-item" href="/v1.0.0">1.0.0</a>
              
              <a class="dropdown-item" href="/v0.9.8">0.9.8</a>
              
              <a class="dropdown-item" href="/v0.9.7">0.9.7</a>
              
              <a class="dropdown-item" href="/v0.9.6">0.9.6</a>
              
              <a class="dropdown-item" href="/v0.9.5">0.9.5</a>
              
              <a class="dropdown-item" href="/v0.9.4">0.9.4</a>
              
              <a class="dropdown-item" href="/v0.9.34">0.9.34</a>
              
              <a class="dropdown-item" href="/v0.9.33">0.9.33</a>
              
              <a class="dropdown-item" href="/v0.9.3">0.9.3</a>
              
              <a class="dropdown-item" href="/v0.9.28">0.9.28</a>
              
              <a class="dropdown-item" href="/v0.9.23">0.9.23</a>
              
              <a class="dropdown-item" href="/v0.9.22">0.9.22</a>
              
              <a class="dropdown-item" href="/v0.9.21">0.9.21</a>
              
              <a class="dropdown-item" href="/v0.9.20">0.9.20</a>
              
              <a class="dropdown-item" href="/v0.9.19">0.9.19</a>
              
              <a class="dropdown-item" href="/v0.9.18">0.9.18</a>
              
              <a class="dropdown-item" href="/v0.9.17">0.9.17</a>
              
              <a class="dropdown-item" href="/v0.9.16">0.9.16</a>
              
              <a class="dropdown-item" href="/v0.9.15">0.9.15</a>
              
              <a class="dropdown-item" href="/v0.9.14">0.9.14</a>
              
              <a class="dropdown-item" href="/v0.9.13">0.9.13</a>
              
              <a class="dropdown-item" href="/v0.9.12">0.9.12</a>
              
              <a class="dropdown-item" href="/v0.9.11">0.9.11</a>
              
              <a class="dropdown-item" href="/v0.9.10">0.9.10</a>
              
              <a class="dropdown-item" href="/v0.9.9">0.9.9</a>
              
              <a class="dropdown-item" href="/v0.9.8">0.9.8</a>
              
              <a class="dropdown-item" href="/v0.9.7">0.9.7</a>
              
              <a class="dropdown-item" href="/v0.9.6">0.9.6</a>
              
              <a class="dropdown-item" href="/v0.9.5">0.9.5</a>
              
              <a class="dropdown-item" href="/v0.9.3">0.9.3</a>
              
              <a class="dropdown-item" href="/v0.9.2">0.9.2</a>
              
              <a class="dropdown-item" href="/v0.9.1">0.9.1</a>
              
              <a class="dropdown-item" href="/v0.9.0">0.9.0</a>
              
              <a class="dropdown-item" href="/v0.8.22">0.8.22</a>
              
              <a class="dropdown-item" href="/v0.8.21">0.8.21</a>
              
            </div>
          </div>
            
          


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Jina Core</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../core/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../core/guides/">Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../core/setup/">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../my_first_jina_app/">Building Your First Jina App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install/ide-speedup/">Speeding Up Development in PyCharm and VSCode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../primitive_data_type/">Primitive Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mime-type/">MIME Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../traversal/">Recursive Document Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executors/">Processing Documents with Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../simple_exec/">Built-in Simple Executors and Reserved <code class="docutils literal notranslate"><span class="pre">uses</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding New Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../peas-and-pods/">Peas and Pods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../driver/">Adding New Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flow/">Composing a Search Workflow with the Flow API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../input_output/">Inputs and Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../crud/">CRUD Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cross_multi_modality/">Multi-modal and Cross-modal Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sparse/">Using Sparse Embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/">Configuring Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/exit/">Exiting a Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dump-reload/">Rolling Updates and Query While Indexing in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../evaluation/">Evaluating a Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../optimization/">Optimizing a Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ranker/">Ranking Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ranker_trainer/">A guide on Jina Ranker Trainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prevent_duplicate_indexing/">Preventing Duplicate Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../incremental_indexing/">Incremental Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../parallel/">Parallelization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../batching/">Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../request_size/">Request Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../remote/">Distributing Jina Remotely</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stress/">Cloud Benchmark &amp; Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../envs/">OS Environment Variables Used in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flow/pattern/">Common Design Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../autocomplete/">Autocomplete commands on Bash, Zsh and Fish</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../core/api_references/">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Dashboard</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dashboard/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dashboard/guides/">Developer Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Hub</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hub/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hub/guides/">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hub/api_references/">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Box</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../box/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../box/guides/">Developer Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING/">Contributing to Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING/#join-us-on-slack">Join Us on Slack!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RELEASE/">Release &amp; Version Identifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG/">Change Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jep/">Jina Enhancement Proposals (JEP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/dev/">FAQ for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/user/">FAQ for End-Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docstring/">Docstring Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Indices and Tables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../all_exec/">List of 123 Executors in Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../all_driver/">List of 62 Drivers in Jina</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">Jina</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation" class="nav-bar-header">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../core/guides/">Developer Guides</a> &raquo;</li>
        
      <li>Adding New Executors</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  
<div role="search" class="nav-bar-search">
  <form id="rtd-search-form" class="wy-form doc-searchbox" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs (Press / to focus)" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

</div>
<hr/>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-new-executors">
<h1><a class="toc-backref" href="#id5">Adding New Executors</a><a class="headerlink" href="#adding-new-executors" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This guide assumes you have a basic understanding of Jina, if you haven’t, please check out <a class="reference external" href="https://101.jina.ai">Jina 101</a> first.</p>
</div>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#adding-new-executors" id="id5">Adding New Executors</a></p>
<ul>
<li><p><a class="reference internal" href="#motivation" id="id6">Motivation</a></p></li>
<li><p><a class="reference internal" href="#overview" id="id7">Overview</a></p></li>
<li><p><a class="reference internal" href="#implementation" id="id8">Implementation</a></p></li>
<li><p><a class="reference internal" href="#how-can-i-use-my-extension" id="id9">How can I use my extension?</a></p></li>
<li><p><a class="reference internal" href="#customize-executor-in-action-clip-encoder" id="id10">Customize executor in action: CLIP encoder</a></p></li>
<li><p><a class="reference internal" href="#share-your-work" id="id11">Share your work!</a></p></li>
<li><p><a class="reference internal" href="#what-s-next" id="id12">What’s next?</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="motivation">
<h2><a class="toc-backref" href="#id6">Motivation</a><a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>As a Jina user, you may have noticed that <a class="reference external" href="https://github.com/jina-ai/jina-hub">Jina Hub</a> is the open registry for hosting Jina Executors.
These <a class="reference external" href="https://docs.jina.ai/chapters/all_exec.html">Executors</a> have been categorised into categories by their type, such as <cite>Encoder</cite>, <cite>Ranker</cite>, <cite>Crafter</cite> etc.</p>
<p>However, when existing Executors do not fit your specific use case, you may want to <strong>extend</strong> Jina. For example, by integrating a new deep learning model, adding a new indexing algorithm, or creating your own evaluation metric.</p>
<p>In this tutorial, we’ll guide you through the steps.
First of all, we will introduce the general steps on how to customize a Jina Executor.
At the end, we will give a concrete example of integrating the text encoder and image encoder on top of OpenAI’s latest published <a class="reference external" href="https://github.com/openai/CLIP">CLIP</a> model.</p>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id7">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>To add a new Jina <cite>Executor</cite>:</p>
<ol class="arabic simple">
<li><p>Decide which <cite>Executor</cite> class to inherit from.</p></li>
<li><p>Override <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code>.</p></li>
<li><p>Overwrite the <strong>core</strong> method of the <cite>Executor</cite>.</p></li>
<li><p>(Optional) Implement the save logic.</p></li>
</ol>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id8">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="decide-which-executor-class-to-inherit-from">
<h3>Decide which <code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code> class to inherit from<a class="headerlink" href="#decide-which-executor-class-to-inherit-from" title="Permalink to this headline">¶</a></h3>
<p>When adding a custom Executor, first inherit the “correct” class based on the use case.
The built-in Executor types are:</p>
<ol class="arabic simple">
<li><p><cite>Encoder</cite>: encode document as vector embeddings.</p></li>
<li><p><cite>Indexer</cite>: save and retrieve vectors and key-value pairs from storage.</p></li>
<li><p><cite>Crafter</cite>:  transform the content of documents.</p></li>
<li><p><cite>Segmenter</cite>:  segment document into smaller pieces of documents.</p></li>
<li><p><cite>Ranker</cite>: calculate scores of documents.</p></li>
<li><p><cite>Classifier</cite>: enrich document with a model.</p></li>
<li><p><cite>Evaluator</cite>: evaluate score based on output and GroundTruth.</p></li>
<li><p><cite>CompoundExecutor</cite>: combine multiple Executors into one.</p></li>
</ol>
<p>As a rule of thumb, you pick the Executor that shares the similar logic to inherit.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your algorithm is relatively unique and does not fit in any of the categories above, you may want to <a class="reference external" href="https://github.com/jina-ai/jina/issues">submit an issue for discussion</a> before you start.</p>
</div>
<table class="colwidths-given docutils align-default" id="id4">
<caption><span class="caption-text">Built-in Executors to inherit from</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Base Class</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>BaseEncoder</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Represent the documents as vector embeddings.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>BaseNumericEncoder</cite></p></td>
<td><p><cite>BaseEncoder</cite></p></td>
<td><p>Represent numpy array object (e.g. image, video, audio) as vector embeddings.</p></td>
</tr>
<tr class="row-even"><td><p><cite>BaseTextEncoder</cite></p></td>
<td><p><cite>BaseEncoder</cite></p></td>
<td><p>Represent string object as vector embeddings.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>BaseMultimodalEncoder</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Encode input from different modalities.</p></td>
</tr>
<tr class="row-even"><td><p><cite>BaseIndexer</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Save and retrieve vectors and key-value pairs from storage.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>BaseVectorIndexer</cite></p></td>
<td><p><cite>BaseIndexer</cite></p></td>
<td><p>Save and retrieve vectors from storage.</p></td>
</tr>
<tr class="row-even"><td><p><cite>NumpyIndexer</cite></p></td>
<td><p><cite>BaseVectorIndexer</cite></p></td>
<td><p>Use numpy array for storage.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>BaseKVIndexer</cite></p></td>
<td><p><cite>BaseIndexer</cite></p></td>
<td><p>Save and retrieve key-value pairs from storage.</p></td>
</tr>
<tr class="row-even"><td><p><cite>BaseCrafter</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Transform the content of Documents.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>BaseSegmenter</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Segment Document into smaller pieces.</p></td>
</tr>
<tr class="row-even"><td><p><cite>BaseRanker</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Calculate scores of Documents.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>Chunk2DocRanker</cite></p></td>
<td><p><cite>BaseRanker</cite></p></td>
<td><p>Translate chunk-wise score (distance) to doc-wise score.</p></td>
</tr>
<tr class="row-even"><td><p><cite>Match2DocRanker</cite></p></td>
<td><p><cite>BaseRanker</cite></p></td>
<td><p>Re-score matches for a Document.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>BaseClassifier</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Enrich documents with a classifier.</p></td>
</tr>
<tr class="row-even"><td><p><cite>BaseEvaluator</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Evaluate score based on output and GroundTruth.</p></td>
</tr>
<tr class="row-odd"><td><p><cite>CompoundExecutor</cite></p></td>
<td><p><cite>BaseExecutor</cite></p></td>
<td><p>Combine multiple Executors into one.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="override-init-and-post-init">
<h3>Override <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code><a class="headerlink" href="#override-init-and-post-init" title="Permalink to this headline">¶</a></h3>
<p>You can put simple type attributes that define the behavior of your <code class="docutils literal notranslate"><span class="pre">Executor</span></code> into <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>. Simple types represent all <cite>pickle</cite>-able types, including: integer, bool, string, tuple of simple types, list of simple types, and map of simple type. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina.executors.crafters</span> <span class="kn">import</span> <span class="n">BaseSegmenter</span>

<span class="k">class</span> <span class="nc">GifPreprocessor</span><span class="p">(</span><span class="n">BaseSegmenter</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_shape</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span> <span class="n">every_k_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">from_bytes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">img_shape</span> <span class="o">=</span> <span class="n">img_shape</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">every_k_frame</span> <span class="o">=</span> <span class="n">every_k_frame</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">max_frame</span> <span class="o">=</span> <span class="n">max_frame</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">from_bytes</span> <span class="o">=</span> <span class="n">from_bytes</span>
</pre></div>
</div>
<p>Remember to add <code class="docutils literal notranslate"><span class="pre">super().__init__(*args,</span> <span class="pre">**kwargs)</span></code> to your <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>. This is the only way you can enjoy many magic features like YAML support, persistence from the base class (and <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseExecutor</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All attributes declared in <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> will be persisted during <code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code>  and <code class="xref py py-meth docutils literal notranslate"><span class="pre">load()</span></code>.</p>
</div>
<p>What if the data you need to load cannot be stored in a simple type?
For example, a deep learning graph, a big pretrained model, a gRPC stub, a TensorFlow session, a thread? The you can put them into <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code>.</p>
<p>It is also interesting to override <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code> when there is a better persistence method other than pickle.
For example, your hyperparameters matrix in numpy <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> is certainly pickle-able. However, you can simply read and write it via standard file IO, and it is likely more efficient than <code class="docutils literal notranslate"><span class="pre">pickle</span></code>. In this case, you load data in <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code>.</p>
<p>Please check the example below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina.executors.encoders</span> <span class="kn">import</span> <span class="n">BaseTextEncoder</span>

<span class="k">class</span> <span class="nc">TextPaddlehubEncoder</span><span class="p">(</span><span class="n">BaseTextEncoder</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ernie_tiny&#39;</span><span class="p">,</span>
                 <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
                 <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="n">max_length</span>


    <span class="k">def</span> <span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">paddlehub</span> <span class="k">as</span> <span class="nn">hub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">Module</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">MAX_SEQ_LEN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code> is also a good place to introduce package dependencies, e.g. <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">x</span> <span class="pre">import</span> <span class="pre">y</span></code>. Naively, you can always put all imports upfront at the top of the file. However, this will throw a <code class="docutils literal notranslate"><span class="pre">ModuleNotFound</span></code> exception when the package is not installed locally. Sometimes one missing dependency may break the whole system.</p>
<p>As a rule of thumb, only import packages where you really need them. Often these dependencies are only required in <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code> and the core method, which we shall see later.</p>
</div>
</div>
<div class="section" id="override-the-core-method-of-the-base-class">
<h3>Override the <em>core</em> method of the base class<a class="headerlink" href="#override-the-core-method-of-the-base-class" title="Permalink to this headline">¶</a></h3>
<p>Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code> has a core method, which defines its algorithmic behavior. When making your own extension, you have to override this core method. The following table lists the core method you may want to override. Note some Executors may have multiple core methods.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Base class</p></td>
<td><p>Core method(s)</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseEncoder</span></code></p></td>
<td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">encode()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseCrafter</span></code></p></td>
<td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">craft()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSegmenter</span></code></p></td>
<td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">segment()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseIndexer</span></code></p></td>
<td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">query()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseRanker</span></code></p></td>
<td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">score()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseClassifier</span></code></p></td>
<td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">predict()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseEvaluator</span></code></p></td>
<td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate()</span></code></p></td>
</tr>
</tbody>
</table>
<p>Feel free to override other methods/properties as you need. But probably, most of the extension can be done by simply overriding the core methods listed above.</p>
</div>
<div class="section" id="implement-the-persistence-logic">
<h3>Implement the persistence logic<a class="headerlink" href="#implement-the-persistence-logic" title="Permalink to this headline">¶</a></h3>
<p>If you don’t override <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code>, then you don’t need to implement persistence logic. You get YAML and persistency support out-of-the-box because of <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseExecutor</span></code>. Simple crafters and rankers fall into this category.</p>
<p>If you override <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code> but you don’t care about persisting its state in the next run (when the Executor process is restarted); or the state is simply unchanged during the run, then you don’t need to implement persistence logic. Loading from a fixed pretrained deep learning model falls into this category.</p>
<p>Persistence logic is only required <strong>when you implement custom loading logic in :meth:`post_init` and the state is changed during the run</strong>. Then you need to override <code class="xref py py-meth docutils literal notranslate"><span class="pre">__getstate__()</span></code>. Many of the indexers fall into this category.</p>
<p>In the example below, the <code class="docutils literal notranslate"><span class="pre">tokenizer</span></code> is loaded in <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code> and saved in <code class="xref py py-meth docutils literal notranslate"><span class="pre">__getstate__()</span></code>, which completes the persistency cycle.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomizedEncoder</span><span class="p">(</span><span class="n">BaseEncoder</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tmp_model_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_abspath</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-can-i-use-my-extension">
<h2><a class="toc-backref" href="#id9">How can I use my extension?</a><a class="headerlink" href="#how-can-i-use-my-extension" title="Permalink to this headline">¶</a></h2>
<p>You can use the extension by specifying <code class="docutils literal notranslate"><span class="pre">py_modules</span></code> in the YAML file. For example, your extension Python file is called <code class="docutils literal notranslate"><span class="pre">my_encoder.py</span></code>, which describes <code class="xref py py-class docutils literal notranslate"><span class="pre">MyEncoder</span></code>. Then you can define a YAML file (say <code class="docutils literal notranslate"><span class="pre">my.yml</span></code>) as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="kt">!MyEncoder</span>
<span class="nt">with</span><span class="p">:</span>
  <span class="nt">greetings</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hello im external encoder</span>
<span class="nt">metas</span><span class="p">:</span>
  <span class="nt">py_modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_encoder.py</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also assign a list of files to <code class="docutils literal notranslate"><span class="pre">metas.py_modules</span></code> if your Python logic is split over multiple files. This YAML file and all Python extension files should be put in the same directory.</p>
</div>
<p>Then simply use it in Jina CLI by specifying <code class="docutils literal notranslate"><span class="pre">jina</span> <span class="pre">pod</span> <span class="pre">--uses=my.yml</span></code>, or <code class="docutils literal notranslate"><span class="pre">Flow().add(uses='my.yml')</span></code> in Flow API.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you use a customized Executor inside a <code class="xref py py-class docutils literal notranslate"><span class="pre">jina.executors.CompoundExecutor</span></code>, then you only need to set <code class="docutils literal notranslate"><span class="pre">metas.py_modules</span></code> at the root level, not at the sub-component level.</p>
</div>
</div>
<div class="section" id="customize-executor-in-action-clip-encoder">
<h2><a class="toc-backref" href="#id10">Customize executor in action: CLIP encoder</a><a class="headerlink" href="#customize-executor-in-action-clip-encoder" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/openai/CLIP">CLIP</a> (Contrastive Language-Image Pre-Training) is a neural network trained on a variety of (image, text) pairs.
Given an image it can be instructed in natural language to predict the most relevant text snippet.</p>
<p>The pre-trained CLIP model is able to transform both images and text into the same latent space,
where image and text emebddings can be compared using a similarity measure.
We will use CLIP as an example to see how to create <a class="reference internal" href="../../glossary/#term-Encoder"><span class="xref std std-term">Encoder</span></a> powered by CLIP model,
for text-to-image search.
You can refer to our <a class="reference external" href="https://github.com/jina-ai/examples/tree/master/cross-modal-search">cross model search</a> to find the example.</p>
<p>Since CLIP maps image and text into a common latent space,
it’s objective is to represent documents as vector embeddings.
So we need to inherit from <cite>BaseEncoder</cite> class.
To encode a piece of text using CLIP, we might create a <cite>CLIPTextEncoder</cite> and inherit from <cite>BaseTextEncoder</cite>.
To encode an image using CLIP, we might create a <cite>CLIPImageEncoder</cite> and inherit from <cite>BaseNumericEncoder</cite>.</p>
<p>The next step is to override <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code>.
For <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code>, we can specify a new parameter called <cite>model_name</cite> since CLIP has two pre-trained models,
i.e. ResNet50 and ViT-B/32.
As mentioned before, it is a good practice to load pre-trained model inside <code class="xref py py-meth docutils literal notranslate"><span class="pre">post_init()</span></code>. Now we have an Encoder like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CLIPTextEncoder</span><span class="p">(</span><span class="n">BaseTextEncoder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encode text into vector embeddings powered by OpenAI&#39;s CLIP model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;ViT-B/32&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>

    <span class="k">def</span> <span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load pre-trained CLIP model.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">clip</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">clip</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

    <span class="c1"># the rest of the code</span>
</pre></div>
</div>
<p>At the end, we need to overwrite the <em>core</em> method of the Executor.
Since it is an Encoder, we need to overwrite the <code class="xref py py-meth docutils literal notranslate"><span class="pre">encode()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CLIPTextEncoder</span><span class="p">(</span><span class="n">BaseTextEncoder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encode text into vector embeddings powered by OpenAI&#39;s CLIP model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;ViT-B/32&#39;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>

    <span class="k">def</span> <span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load pre-trained CLIP model.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">clip</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">clip</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;np.ndarray&#39;</span><span class="p">:</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="n">clip</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">encoded_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">encode_text</span><span class="p">(</span><span class="n">tensor</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">encoded_data</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</pre></div>
</div>
<p>In the code sample above, we called CLIP’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">encode_text()</span></code> to use the pre-trained CLIP model and encode input data into vector embeddings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The example above is a minimum working example of a <cite>CLIPTextEncoder</cite>, for full features such as GPU support, batching and dockerization, please check out <a class="reference external" href="https://github.com/jina-ai/jina-hub/tree/master/encoders">Jina-hub</a>.</p>
</div>
<p>The same applies to <cite>CLIPImageEncoder</cite>, the only difference is to use <code class="xref py py-meth docutils literal notranslate"><span class="pre">self.model.encode_image()</span></code> in <code class="xref py py-meth docutils literal notranslate"><span class="pre">encode()</span></code>.
Last but not least, create the YAML configuration for the encoder and use it with Jina CLI or Flow API.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="kt">!CLIPTextEncoder</span>
<span class="nt">metas</span><span class="p">:</span>
  <span class="nt">py_modules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">__init__.py</span>
</pre></div>
</div>
<p>Then use it in Jina CLI by specifying <code class="docutils literal notranslate"><span class="pre">jina</span> <span class="pre">pod</span> <span class="pre">--uses=config.yml</span></code>,
or <code class="docutils literal notranslate"><span class="pre">Flow().add(uses='config.yml')</span></code> in Flow API.
And you have a good foundation to build your index/query Flow powered by CLIP.</p>
</div>
<div class="section" id="share-your-work">
<h2><a class="toc-backref" href="#id11">Share your work!</a><a class="headerlink" href="#share-your-work" title="Permalink to this headline">¶</a></h2>
<p>If you would like to share your customized Executor with the community, you are more than welcome!
We use <a class="reference external" href="https://github.com/cookiecutter/cookiecutter">cookiecutter</a> to create Jina Executors from a template.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Install Docker and run <cite>pip install “jina[devel]”</cite> before you start.</p>
</div>
<p>To make sure your work is in good shape, Jina provides a wizard to help you create a Executor. Start it with <cite>jina hub new –type pod</cite>.
It will generate a standard Executor project like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>CLIPTextEncoder/
├── Dockerfile
├── manifest.yml
├── README.md
├── config.yml
├── requirements.txt
├── __init__.py
└── tests/
    ├── test_CLIPTextEncoder.py
    └── __init__.py
</pre></div>
</div>
<p>You can put your customized Encoder, such as <cite>CLIPTextEncoder</cite> inside <cite>__init__.py</cite>.
The YAML configuration should be placed in <cite>config.yml</cite>.</p>
<p>To ensure your custom Executor, like <cite>CLIPTextEncoder</cite>, performs exactly the same as the original CLIP model,
add tests inside <cite>tests</cite> folder.
For example, encode some text data with the raw CLIP model, and assert we get the same result with <cite>CLIPTextEncoder</cite>.</p>
<p>Build and test your Encoder locally with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jina hub build -t jinahub/type.kind.jina-image-name:image_version-jina_version &lt;your_folder&gt;
</pre></div>
</div>
<p>Once tested, you should login to Jina Hub with <cite>jina hub login</cite>, and copy/paste the token into GitHub to verify your account.
You are now able to push your work to Jina Hub:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jina hub push jinahub/type.kind.jina-image-name:image-jina_version
</pre></div>
</div>
<p>In our example, the type is <cite>pod</cite>, kind is <cite>encoder</cite> and <cite>jina-image-name</cite> is <cite>cliptextencoder</cite> and <cite>clipimageencoder</cite>.</p>
</div>
<div class="section" id="what-s-next">
<h2><a class="toc-backref" href="#id12">What’s next?</a><a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>Thanks for your time and effort while reading this guide!</p>
<p>Please check out <a class="reference external" href="https://github.com/jina-ai/jina-hub">Jina Hub</a> to explore the Executors.
If you still have questions, feel free to <a class="reference external" href="https://github.com/jina-ai/jina/issues">submit an issue</a> or post a message in our <a class="reference external" href="https://docs.jina.ai/chapters/CONTRIBUTING.html#join-us-on-slack">community slack channel</a> .</p>
<p>To gain a deeper knowledge of the implementation of Jina Executors, you can find the source code <a class="reference external" href="https://github.com/jina-ai/jina/tree/master/jina/executors">here</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        
        <a href="../../peas-and-pods/" class="btn btn-neutral float-right" title="Peas and Pods"
           accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
        
        
        <a href="../../simple_exec/" class="btn btn-neutral float-left" title="Built-in Simple Executors and Reserved uses"
           accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
        
    </div>
    

    <hr/>

    <div role="contentinfo">
        <nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">

            <ul class="devsite-footer-linkboxes-list">

                <li class="devsite-footer-linkbox ">
                    <h3 class="devsite-footer-linkbox-heading no-link">Stay connected</h3>
                    <ul class="devsite-footer-linkbox-list">

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">

                                <i class="fab fa-github"></i> GitHub

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://www.linkedin.com/company/jinaai/" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">

                                <i class="fab fa-linkedin"></i> LinkedIn

                            </a>

                        </li>



                        <li class="devsite-footer-linkbox-item">

                            <a href="https://twitter.com/JinaAI_" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">

                                <i class="fab fa-twitter"></i> Twitter

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://www.youtube.com/c/JinaAI" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">

                                <i class="fab fa-youtube"></i> YouTube

                            </a>

                        </li>

                    </ul>
                </li>

                <li class="devsite-footer-linkbox ">
                    <h3 class="devsite-footer-linkbox-heading no-link">Support</h3>
                    <ul class="devsite-footer-linkbox-list">
                        <li class="devsite-footer-linkbox-item">

                            <a href="https://slack.jina.ai"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">

                                <i class="fab fa-slack"></i> Slack community

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina/issues"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">

                                Issue tracker

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina/blob/master/CHANGELOG.md"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">

                                Release notes

                            </a>

                        </li>



                        <li class="devsite-footer-linkbox-item">

                            <a href="https://career.jina.ai"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">

                                Career@Jina AI

                            </a>

                        </li>


                    </ul>
                </li>

            </ul>

        </nav>
        <p>
            
            &copy; Copyright Jina AI Limited. All rights reserved.
            <span class="lastupdated">
        Last updated on Jun 10, 2021.
      </span>

        </p>
    </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });

      function showhide_navbar() {
      var x = document.getElementsByClassName("wy-nav-side")[0];
      var y = document.getElementsByClassName("wy-nav-content-wrap")[0];
      var z = document.getElementById("showhide-navbar-btn");
      if (x.style.display === "none") {
        x.style.display = "block";
        y.style.marginLeft = "300px";
        z.style.left = "300px";
      } else {
        x.style.display = "none";
        y.style.marginLeft = "0";
        z.style.left = "0px";
      }
    }

  </script>

  <!-- Search box becomes active when you press the slash(/) key anywhere on the page-->
  <script>
    const body = document.querySelector('body');
    const searchBox = document.querySelector('form').querySelector('input[type="text"]');

    body.addEventListener('keyup', event => {
      event.preventDefault()
      if (event.key === '/') {
        searchBox.focus();
      }
    });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-164627626-3', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>