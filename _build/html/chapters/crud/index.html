

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="X-UA-Compatible" content="IE=edge">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@JinaAI_">
<meta name="twitter:creator" content="@JinaAI_">
<meta name="description"
      content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:title" content="Jina Documentation">
<meta property="og:description"
      content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:url" content="https://opensource.jina.ai">
<meta property="og:image" content="../../_static/banner.png">
<meta property="og:type" content="website">
<link rel="icon" href="../../_static/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>CRUD Operations &mdash; Jina 0.9.25 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/main.css" type="text/css" />


  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">
  <div id="showhide-navbar-btn" onclick="showhide_navbar();"></div>

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://docs.jina.ai">
          

          
            
            <img src="../../_static/jina-prod-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            

          <div class="dropdown version">
            <button class="dropbtn version">0.9.25</button>
            <div class="dropdown-content">
              
              <a class="dropdown-item" href="/master">master</a>
              
              <a class="dropdown-item" href="/v0.9.21">0.9.21</a>
              
              <a class="dropdown-item" href="/v0.9.20">0.9.20</a>
              
              <a class="dropdown-item" href="/v0.9.19">0.9.19</a>
              
              <a class="dropdown-item" href="/v0.9.18">0.9.18</a>
              
              <a class="dropdown-item" href="/v0.9.17">0.9.17</a>
              
              <a class="dropdown-item" href="/v0.9.16">0.9.16</a>
              
              <a class="dropdown-item" href="/v0.9.15">0.9.15</a>
              
              <a class="dropdown-item" href="/v0.9.14">0.9.14</a>
              
              <a class="dropdown-item" href="/v0.9.13">0.9.13</a>
              
              <a class="dropdown-item" href="/v0.9.12">0.9.12</a>
              
              <a class="dropdown-item" href="/v0.9.11">0.9.11</a>
              
              <a class="dropdown-item" href="/v0.9.10">0.9.10</a>
              
              <a class="dropdown-item" href="/v0.9.9">0.9.9</a>
              
              <a class="dropdown-item" href="/v0.9.8">0.9.8</a>
              
              <a class="dropdown-item" href="/v0.9.7">0.9.7</a>
              
              <a class="dropdown-item" href="/v0.9.6">0.9.6</a>
              
              <a class="dropdown-item" href="/v0.9.5">0.9.5</a>
              
              <a class="dropdown-item" href="/v0.9.3">0.9.3</a>
              
              <a class="dropdown-item" href="/v0.9.2">0.9.2</a>
              
              <a class="dropdown-item" href="/v0.9.1">0.9.1</a>
              
              <a class="dropdown-item" href="/v0.9.0">0.9.0</a>
              
              <a class="dropdown-item" href="/v0.8.22">0.8.22</a>
              
              <a class="dropdown-item" href="/v0.8.21">0.8.21</a>
              
            </div>
          </div>
            
          


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/os/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helloworld/index.html">Jina ‚ÄúHello, World!‚Äù üëãüåç</a></li>
<li class="toctree-l1"><a class="reference internal" href="../101/index.html">Jina 101: First Thing to Learn About Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow/index.html">Using Flow API to Compose Your Jina Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/index.html">Input and Output Functions in Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/exit.html">Gracefully Exit Jina</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Jina Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/jina.html">Jina Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yaml/index.html">Jina YAML Syntax Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proto/index.html">Jina Protobuf Specification</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../traversal/index.html">Understand Jina Recursive Document Representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flow/pattern.html">Common Design Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cross-multi-modality/index.html">Multi &amp; Cross Modality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hub/index.html">Using Jina Pod with Docker Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote/index.html">Using Jina Pod Remotely</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging/index.html">Logging configuration in jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dashboard/index.html">Using Dashboard to Monitor Logs and View Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simple_exec.html">Built-in Simple Executors and Reserved <code class="docutils literal notranslate"><span class="pre">uses</span></code> in Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../restapi/index.html">Jina REST API Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../envs.html">OS Environment Variables Used in Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prevent_duplicate_indexing/index.html">Prevent Indexing Duplicates</a></li>
</ul>
<p class="caption"><span class="caption-text">Extensions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extend/executor.html">Guideline When Adding New Executor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extend/mwu.html">A Minimum Working Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extend/driver.html">Guideline When Adding New Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hub/publish-your-pod-image.html">Publish Your Pod Image to Jina Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_schema.html">Jina API Schema for 3rd-Party Applications</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing to Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html#join-us-on-slack">Join Us on Slack!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE.html">Release &amp; Version Identifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Change Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jep/index.html">Jina Enhancement Proposals (JEP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/dev.html">FAQ for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/user.html">FAQ for End-Users</a></li>
</ul>
<p class="caption"><span class="caption-text">Indices and Tables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../all_exec.html">List of 123 Executors in Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../all_driver.html">List of 62 Drivers in Jina</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Jina</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation" class="nav-bar-header">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>CRUD Operations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  
<div role="search" class="nav-bar-search">
  <form id="rtd-search-form" class="wy-form doc-searchbox" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs (Press / to focus)" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

</div>
<hr/>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="crud-operations">
<h1>CRUD Operations<a class="headerlink" href="#crud-operations" title="Permalink to this headline">¬∂</a></h1>
<p>CRUD stands for Create, Read, Update, Delete. Together, they form the basis of any database engine. While Jina itself is <em>not</em> a database engine, it does provide these methods of interacting with the data stored in the indexers.</p>
<p>Until now, Jina has only supported indexing (creating) and querying (reading) documents. To update or delete a document, you‚Äôd have to edit your dataset, and then re-build the Flow and indexers. Needless to say, this could create problems if you had large datasets.</p>
<p>With the release of version <code class="docutils literal notranslate"><span class="pre">1.0</span></code> we‚Äôre introducing <strong>update</strong> and <strong>delete</strong> operations. These are implemented across our executors and drivers and will allow you to update and delete documents by their ids.</p>
<p>A basic example of this can be found in the <code class="docutils literal notranslate"><span class="pre">test_crud.py</span></code> file under <code class="docutils literal notranslate"><span class="pre">tests/integration/crud/simple</span></code>:</p>
<p>The Flow object now supports a <code class="docutils literal notranslate"><span class="pre">delete</span></code> and <code class="docutils literal notranslate"><span class="pre">update</span></code> method, with a signature similar to index:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">with</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">input_fn</span><span class="o">=</span><span class="n">random_docs</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">input_fn</span><span class="o">=</span><span class="n">random_docs</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">input_fn</span><span class="o">=</span><span class="n">random_docs</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<p>Note: deletion and update will happen by <code class="docutils literal notranslate"><span class="pre">id</span></code> of the document.</p>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¬∂</a></h2>
<p>Unfortunately there are some limitations to what Jina can do for the moment. These were trade-offs we needed to implement to keep Jina performant, robust, and easy to use. Some of these will be addressed in future versions, while some are intrinsic to Jina‚Äôs architecture.</p>
<ol class="simple">
<li><p><strong>Partial update</strong></p></li>
</ol>
<p>For the moment we do not support partial updates. So if you want to update a document, you need to send the entire document. This is due to Jina‚Äôs architecture: the document is sent as one piece through the Flow.</p>
<ol class="simple">
<li><p><strong>Update flows</strong></p></li>
</ol>
<p>In the context of Flows with segmenters and chunks, a Document may end up being split into chunks. Currently, the Update request will not work for these. You will need to manually remove the chunks by their <code class="docutils literal notranslate"><span class="pre">ids</span></code>. Then you can remove the parent document as well, by its <code class="docutils literal notranslate"><span class="pre">id</span></code>. Finally, you can index the new document, with its new contents (and thus new, different child chunks).</p>
<ol class="simple">
<li><p><strong>Sharding</strong></p></li>
</ol>
<p>When sharding data in indexers, the data will be split across these. This is achieved due to the <code class="docutils literal notranslate"><span class="pre">polling:</span> <span class="pre">any</span></code> configuration. During a query, you will need to set <code class="docutils literal notranslate"><span class="pre">polling:</span> <span class="pre">all</span></code>. However, this will lead to some shards getting a query request with a key that doesn‚Äôt exist. In this case, warnings will be emitted by the indexer. You can ignore these within this context. The warnings are there for the situations when missing keys are <em>not</em> expected.</p>
<ol class="simple">
<li><p><strong>Indexing while querying</strong></p></li>
</ol>
<p>The index, update, and delete operations cannot be executed within the same context as the query operation. This is due to the way flushing to disk works within the Flow and Executor context lifecycle. This is applicable across all VectorIndexers. Thus, you need to exit the Flow context when you want to switch from one set of operations to the other.</p>
<p>You can see this in the code listing in the beginning of this chapter.</p>
<ol class="simple">
<li><p><strong>Expanding size</strong></p></li>
</ol>
<p>The update and delete operations use a masking underneath. This is done to maintain high performance overall. However, this means that old data will not be deleted, but will simply be masked as being deleted. Thus the size on disk (and in memory) of the indexer will grow over time if you perform update or delete operations. We recommend you rebuild the indexers regularly.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    

    <hr/>

    <div role="contentinfo">
        <nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">

            <ul class="devsite-footer-linkboxes-list">

                <li class="devsite-footer-linkbox ">
                    <h3 class="devsite-footer-linkbox-heading no-link">Stay connected</h3>
                    <ul class="devsite-footer-linkbox-list">

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">

                                <i class="fab fa-github"></i> GitHub

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://www.linkedin.com/company/jinaai/" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">

                                <i class="fab fa-linkedin"></i> LinkedIn

                            </a>

                        </li>



                        <li class="devsite-footer-linkbox-item">

                            <a href="https://twitter.com/JinaAI_" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">

                                <i class="fab fa-twitter"></i> Twitter

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://www.youtube.com/c/JinaAI" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">

                                <i class="fab fa-youtube"></i> YouTube

                            </a>

                        </li>

                    </ul>
                </li>

                <li class="devsite-footer-linkbox ">
                    <h3 class="devsite-footer-linkbox-heading no-link">Support</h3>
                    <ul class="devsite-footer-linkbox-list">
                        <li class="devsite-footer-linkbox-item">

                            <a href="https://slack.jina.ai"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">

                                <i class="fab fa-slack"></i> Slack community

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina/issues"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">

                                Issue tracker

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina/blob/master/CHANGELOG.md"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">

                                Release notes

                            </a>

                        </li>



                        <li class="devsite-footer-linkbox-item">

                            <a href="https://career.jina.ai"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">

                                Career@Jina AI

                            </a>

                        </li>


                    </ul>
                </li>

            </ul>

        </nav>
        <p>
            
            &copy; Copyright Jina AI Limited. All rights reserved.
            <span class="lastupdated">
        Last updated on Feb 01, 2021.
      </span>

        </p>
    </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });

      function showhide_navbar() {
      var x = document.getElementsByClassName("wy-nav-side")[0];
      var y = document.getElementsByClassName("wy-nav-content-wrap")[0];
      var z = document.getElementById("showhide-navbar-btn");
      if (x.style.display === "none") {
        x.style.display = "block";
        y.style.marginLeft = "300px";
        z.style.left = "300px";
      } else {
        x.style.display = "none";
        y.style.marginLeft = "0";
        z.style.left = "0px";
      }
    }

  </script>

  <!-- Search box becomes active when you press the slash(/) key anywhere on the page-->
  <script>
    const body = document.querySelector('body');
    const searchBox = document.querySelector('form').querySelector('input[type="text"]');

    body.addEventListener('keyup', event => {
      event.preventDefault()
      if (event.key === '/') {
        searchBox.focus();
      }
    });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-164627626-3', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>