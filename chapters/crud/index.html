

<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="X-UA-Compatible" content="IE=edge">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@JinaAI_">
<meta name="twitter:creator" content="@JinaAI_">
<meta name="description"
      content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:title" content="Jina Documentation">
<meta property="og:description"
      content="Jina is the cloud-native neural search solution powered by the state-of-the-art AI and deep learning">
<meta property="og:url" content="https://opensource.jina.ai">
<meta property="og:image" content="../../_static/banner.png">
<meta property="og:type" content="website">
<link rel="icon" href="../../_static/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>CRUD Operations in Jina &mdash; Jina 1.1.8-master documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/main.css" type="text/css" />


  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="A Guide to Jina Rankers" href="../ranker/" />
    <link rel="prev" title="How to handle Inputs and Outputs for Flows" href="../input_output/" /> 
</head>

<body class="wy-body-for-nav">
  <div id="showhide-navbar-btn" onclick="showhide_navbar();"></div>

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="https://docs.jina.ai">
          

          
            
            <img src="../../_static/jina-prod-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            

          <div class="dropdown version">
            <button class="dropbtn version">1.1.8-master</button>
            <div class="dropdown-content">
              
              <a class="dropdown-item" href="/master">master</a>
              
              <a class="dropdown-item" href="/v1.1.5">1.1.5</a>
              
              <a class="dropdown-item" href="/v1.1.4">1.1.4</a>
              
              <a class="dropdown-item" href="/v1.1.3">1.1.3</a>
              
              <a class="dropdown-item" href="/v1.1.2">1.1.2</a>
              
              <a class="dropdown-item" href="/v1.1.1">1.1.1</a>
              
              <a class="dropdown-item" href="/v1.1.0">1.1.0</a>
              
              <a class="dropdown-item" href="/v1.0.9">1.0.9</a>
              
              <a class="dropdown-item" href="/v1.0.7">1.0.7</a>
              
              <a class="dropdown-item" href="/v1.0.6">1.0.6</a>
              
              <a class="dropdown-item" href="/v1.0.5">1.0.5</a>
              
              <a class="dropdown-item" href="/v1.0.4">1.0.4</a>
              
              <a class="dropdown-item" href="/v1.0.3">1.0.3</a>
              
              <a class="dropdown-item" href="/v1.0.2">1.0.2</a>
              
              <a class="dropdown-item" href="/v1.0.1">1.0.1</a>
              
              <a class="dropdown-item" href="/v1.0.0">1.0.0</a>
              
              <a class="dropdown-item" href="/v0.9.8">0.9.8</a>
              
              <a class="dropdown-item" href="/v0.9.7">0.9.7</a>
              
              <a class="dropdown-item" href="/v0.9.6">0.9.6</a>
              
              <a class="dropdown-item" href="/v0.9.5">0.9.5</a>
              
              <a class="dropdown-item" href="/v0.9.4">0.9.4</a>
              
              <a class="dropdown-item" href="/v0.9.34">0.9.34</a>
              
              <a class="dropdown-item" href="/v0.9.33">0.9.33</a>
              
              <a class="dropdown-item" href="/v0.9.3">0.9.3</a>
              
              <a class="dropdown-item" href="/v0.9.28">0.9.28</a>
              
              <a class="dropdown-item" href="/v0.9.23">0.9.23</a>
              
              <a class="dropdown-item" href="/v0.9.22">0.9.22</a>
              
              <a class="dropdown-item" href="/v0.9.21">0.9.21</a>
              
              <a class="dropdown-item" href="/v0.9.20">0.9.20</a>
              
              <a class="dropdown-item" href="/v0.9.19">0.9.19</a>
              
              <a class="dropdown-item" href="/v0.9.18">0.9.18</a>
              
              <a class="dropdown-item" href="/v0.9.17">0.9.17</a>
              
              <a class="dropdown-item" href="/v0.9.16">0.9.16</a>
              
              <a class="dropdown-item" href="/v0.9.15">0.9.15</a>
              
              <a class="dropdown-item" href="/v0.9.14">0.9.14</a>
              
              <a class="dropdown-item" href="/v0.9.13">0.9.13</a>
              
              <a class="dropdown-item" href="/v0.9.12">0.9.12</a>
              
              <a class="dropdown-item" href="/v0.9.11">0.9.11</a>
              
              <a class="dropdown-item" href="/v0.9.10">0.9.10</a>
              
              <a class="dropdown-item" href="/v0.9.9">0.9.9</a>
              
              <a class="dropdown-item" href="/v0.9.8">0.9.8</a>
              
              <a class="dropdown-item" href="/v0.9.7">0.9.7</a>
              
              <a class="dropdown-item" href="/v0.9.6">0.9.6</a>
              
              <a class="dropdown-item" href="/v0.9.5">0.9.5</a>
              
              <a class="dropdown-item" href="/v0.9.3">0.9.3</a>
              
              <a class="dropdown-item" href="/v0.9.2">0.9.2</a>
              
              <a class="dropdown-item" href="/v0.9.1">0.9.1</a>
              
              <a class="dropdown-item" href="/v0.9.0">0.9.0</a>
              
              <a class="dropdown-item" href="/v0.8.22">0.8.22</a>
              
              <a class="dropdown-item" href="/v0.8.21">0.8.21</a>
              
            </div>
          </div>
            
          


          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Jina Core</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../core/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/setup/">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../core/guides/">Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../core/setup/">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../my_first_jina_app/">How to Build Your First Jina App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extend/mwu/">A Minimum Working Example of Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project_guide/">How to Set up Jina Correctly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../executors/">Understanding Jina Executors and How to Use Them</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peas-and-pods/">Understanding Peas and Pods in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../primitive_data_type/">Understanding Jina Primitive Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../traversal/">Understand Jina Recursive Document Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow/">Using the Flow API to Compose Your Jina Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../flow/pattern/">Common Design Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../input_output/">How to handle Inputs and Outputs for Flows</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">CRUD Operations in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ranker/">A Guide to Jina Rankers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli/exit/">How to Correctly Exit Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cross_multi_modality/">Understanding Multi-modal and Cross-modal Search in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extend/driver/">How to Add New Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extend/executor/">How to Add New Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../envs/">OS Environment Variables Used in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mime-type/">A Guide to MIME Types in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/">Logging Configuration in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../prevent_duplicate_indexing/">How to Prevent Duplicate Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parallel/">How to Use Parallelization in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simple_exec/">Built-in Simple Executors and Reserved <code class="docutils literal notranslate"><span class="pre">uses</span></code> in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization/">How to Optimize the Jina Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../batching/">Understanding Batching in Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../request_size/">Understanding the Request Size parameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../evaluation/">A Guide to Jina Flow Evaluation Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../incremental_indexing/">How to Use Incremental Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../remote/">Distributed Jina</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stress/">Jina Cloud Benchmark &amp; Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../core/api_references/">API References</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Dashboard</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dashboard/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dashboard/guides/">Developer Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Hub</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hub/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hub/guides/">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hub/api_references/">API References</a></li>
</ul>
<p class="caption"><span class="caption-text">Jina Box</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../box/introduction/">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../box/guides/">Developer Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Glossary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary/">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/">Contributing to Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING/#join-us-on-slack">Join Us on Slack!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE/">Release &amp; Version Identifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG/">Change Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jep/">Jina Enhancement Proposals (JEP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/dev/">FAQ for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/user/">FAQ for End-Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docstring/">Docstring Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Indices and Tables</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../all_exec/">List of 68 Executors in Jina</a></li>
<li class="toctree-l1"><a class="reference internal" href="../all_driver/">List of 78 Drivers in Jina</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Jina</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation" class="nav-bar-header">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../core/guides/">Developer Guides</a> &raquo;</li>
        
      <li>CRUD Operations in Jina</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  
<div role="search" class="nav-bar-search">
  <form id="rtd-search-form" class="wy-form doc-searchbox" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs (Press / to focus)" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

</div>
<hr/>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="crud-operations-in-jina">
<h1>CRUD Operations in Jina<a class="headerlink" href="#crud-operations-in-jina" title="Permalink to this headline">¬∂</a></h1>
<div class="section" id="in-this-section-you-will-get-an-overview-of-how-jina-implements-crud-create-read-update-delete">
<h2>In this section, you will get an overview of how Jina implements CRUD: Create, Read, Update, Delete<a class="headerlink" href="#in-this-section-you-will-get-an-overview-of-how-jina-implements-crud-create-read-update-delete" title="Permalink to this headline">¬∂</a></h2>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¬∂</a></h2>
<p>CRUD abbreviates the four actions <strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate, and <strong>D</strong>elete. All together they form the basis of a database management system (DBMS). While Jina itself is <em>not</em> a DBMS, it does provide these methods of interacting with the data stored in its indexes. Jina uses the following terms for this:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>CRUD Term</th>
<th>Jina Term</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create</td>
<td>Index</td>
</tr>
<tr>
<td>Read</td>
<td>Query</td>
</tr>
<tr>
<td>Update</td>
<td>Update</td>
</tr>
<tr>
<td>Delete</td>
<td>Delete</td>
</tr>
</tbody>
</table><p>We hope that the table above will help to avoid any possible confusion regarding the terms that are in use. We discuss the four actions in more detail below.</p>
</div>
<div class="section" id="availability-in-jina">
<h2>Availability in Jina<a class="headerlink" href="#availability-in-jina" title="Permalink to this headline">¬∂</a></h2>
<p>Before version <code class="docutils literal notranslate"><span class="pre">1.0</span></code>, Jina only supported indexing (creating) and querying (reading) Documents. In order to update or delete a Document, you had to edit your dataset first, and then rebuild both the Flow and the corresponding indexes. Needless to say, this could create problems if you had large datasets.</p>
<p>With the release of version <code class="docutils literal notranslate"><span class="pre">1.0</span></code> we are introducing <strong>update</strong> and <strong>delete</strong> operations. These are implemented across our Executors and Drivers, and allow you to update and delete Documents by their ids. With this, the full CRUD functionality is established and available for you in Jina.</p>
</div>
<div class="section" id="crud-actions-in-jina">
<h2>CRUD actions in Jina<a class="headerlink" href="#crud-actions-in-jina" title="Permalink to this headline">¬∂</a></h2>
<p>What do the four CRUD actions mean, and do in Jina in particular:</p>
<ul class="simple">
<li><p>Index: read a new Document, and add it to the search index.</p></li>
<li><p>Query: retrieve indexed Documents based on given search criteria.</p></li>
<li><p>Update: update an existing Document by re-indexing it. Requires the
index id of the Document to be updated.</p></li>
<li><p>Delete: remove an existing Document from the search index. Requires
the index id of the Document to be deleted from the search index.</p></li>
</ul>
</div>
<div class="section" id="before-you-start">
<h2>Before you start<a class="headerlink" href="#before-you-start" title="Permalink to this headline">¬∂</a></h2>
<p>Before you start indexing documents with Jina and searching through the database, we recommend you to study the basics as explained <a class="reference external" href="https://docs.jina.ai/chapters/core/introduction/index.html">here</a>.</p>
<div class="section" id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¬∂</a></h3>
<div class="section" id="indexing">
<h4>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¬∂</a></h4>
<p>As explained above, indexing means reading a document, and adding it to the search index. The example code below defines four documents, and indexes them.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># import required python modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Flow</span>

<span class="c1"># define the four documents</span>
<span class="n">docs</span> <span class="o">=</span> <span class="p">[</span>
         <span class="n">Document</span><span class="p">(</span>
           <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;üê≤&#39;</span><span class="p">,</span>
           <span class="n">embedding</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
           <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;guardian&#39;</span><span class="p">:</span> <span class="s1">&#39;Azure Dragon&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;East&#39;</span><span class="p">}</span>
         <span class="p">),</span>
         <span class="n">Document</span><span class="p">(</span>
           <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;üê¶&#39;</span><span class="p">,</span>
           <span class="n">embedding</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
           <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;guardian&#39;</span><span class="p">:</span> <span class="s1">&#39;Vermilion Bird&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;South&#39;</span><span class="p">}</span>
         <span class="p">),</span>
         <span class="n">Document</span><span class="p">(</span>
           <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;üê¢&#39;</span><span class="p">,</span>
           <span class="n">embedding</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
           <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;guardian&#39;</span><span class="p">:</span> <span class="s1">&#39;Black Tortoise&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;North&#39;</span><span class="p">}</span>
         <span class="p">),</span>
         <span class="n">Document</span><span class="p">(</span>
           <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;üêØ&#39;</span><span class="p">,</span>
           <span class="n">embedding</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
           <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;guardian&#39;</span><span class="p">:</span> <span class="s1">&#39;White Tiger&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;West&#39;</span><span class="p">}</span>
         <span class="p">)</span>
       <span class="p">]</span>

<span class="c1"># build a Flow with a simple indexer</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="s1">&#39;_index&#39;</span><span class="p">)</span>

<span class="c1"># save four docs (both embedding and structured info) into storage</span>
<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">on_done</span><span class="o">=</span><span class="nb">print</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="searching">
<h4>Searching<a class="headerlink" href="#searching" title="Permalink to this headline">¬∂</a></h4>
<p>The next step is retrieving the indexed Documents. This can be done with just two lines of code, and will output the top-3 neighbours of üê≤, which are üê≤üê¶üê¢  with a score of 0, 1, 1 respectively.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">on_done</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matches</span><span class="p">))</span>
</pre></div>
</div>
<p>The output is as follows in JSON style:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;üê≤&quot;</span><span class="p">,</span> <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;guardian&quot;</span><span class="p">:</span> <span class="s2">&quot;Azure Dragon&quot;</span><span class="p">,</span> <span class="nt">&quot;position&quot;</span><span class="p">:</span> <span class="s2">&quot;East&quot;</span><span class="p">},</span> <span class="nt">&quot;embedding&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;dense&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;buffer&quot;</span><span class="p">:</span> <span class="s2">&quot;AAAAAAAAAAAAAAAAAAAAAA==&quot;</span><span class="p">,</span> <span class="nt">&quot;shape&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nt">&quot;dtype&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;i8&quot;</span><span class="p">}},</span> <span class="nt">&quot;score&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;opName&quot;</span><span class="p">:</span> <span class="s2">&quot;NumpyIndexer&quot;</span><span class="p">,</span> <span class="nt">&quot;refId&quot;</span><span class="p">:</span> <span class="s2">&quot;üê≤&quot;</span><span class="p">},</span> <span class="nt">&quot;adjacency&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;üê¶&quot;</span><span class="p">,</span> <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;position&quot;</span><span class="p">:</span> <span class="s2">&quot;South&quot;</span><span class="p">,</span> <span class="nt">&quot;guardian&quot;</span><span class="p">:</span> <span class="s2">&quot;Vermilion Bird&quot;</span><span class="p">},</span> <span class="nt">&quot;embedding&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;dense&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;buffer&quot;</span><span class="p">:</span> <span class="s2">&quot;AQAAAAAAAAAAAAAAAAAAAA==&quot;</span><span class="p">,</span> <span class="nt">&quot;shape&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nt">&quot;dtype&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;i8&quot;</span><span class="p">}},</span> <span class="nt">&quot;score&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nt">&quot;opName&quot;</span><span class="p">:</span> <span class="s2">&quot;NumpyIndexer&quot;</span><span class="p">,</span> <span class="nt">&quot;refId&quot;</span><span class="p">:</span> <span class="s2">&quot;üê≤&quot;</span><span class="p">},</span> <span class="nt">&quot;adjacency&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;üê¢&quot;</span><span class="p">,</span> <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;guardian&quot;</span><span class="p">:</span> <span class="s2">&quot;Black Tortoise&quot;</span><span class="p">,</span> <span class="nt">&quot;position&quot;</span><span class="p">:</span> <span class="s2">&quot;North&quot;</span><span class="p">},</span> <span class="nt">&quot;embedding&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;dense&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;buffer&quot;</span><span class="p">:</span> <span class="s2">&quot;AAAAAAAAAAABAAAAAAAAAA==&quot;</span><span class="p">,</span> <span class="nt">&quot;shape&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nt">&quot;dtype&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;i8&quot;</span><span class="p">}},</span> <span class="nt">&quot;score&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nt">&quot;opName&quot;</span><span class="p">:</span> <span class="s2">&quot;NumpyIndexer&quot;</span><span class="p">,</span> <span class="nt">&quot;refId&quot;</span><span class="p">:</span> <span class="s2">&quot;üê≤&quot;</span><span class="p">},</span> <span class="nt">&quot;adjacency&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-and-updating">
<h4>Deleting and updating<a class="headerlink" href="#deleting-and-updating" title="Permalink to this headline">¬∂</a></h4>
<p>The previous two examples already demonstrated the capabilities of the <code class="docutils literal notranslate"><span class="pre">Flow</span></code> class. It supports <code class="docutils literal notranslate"><span class="pre">delete</span></code> and <code class="docutils literal notranslate"><span class="pre">update</span></code> methods too, with a signature similar to <code class="docutils literal notranslate"><span class="pre">index</span></code>.</p>
<p>The source code below extends the previous example, and demonstrates how to update an existing document. The position of the Azure Dragon changes from East to North East.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define document to be updated</span>
<span class="n">update_docs</span> <span class="o">=</span> <span class="p">[</span>
         <span class="n">Document</span><span class="p">(</span>
           <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;üê≤&#39;</span><span class="p">,</span>
           <span class="n">embedding</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
           <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;guardian&#39;</span><span class="p">:</span> <span class="s1">&#39;Azure Dragon&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;North East&#39;</span><span class="p">}</span>
         <span class="p">)</span>
       <span class="p">]</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">input_fn</span><span class="o">=</span><span class="n">update_docs</span><span class="p">)</span>
</pre></div>
</div>
<p>Deleting a document from a search index can be done similarly. From the search index, The document referring to the Vermilion Bird will be deleted.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define document to be deleted</span>
<span class="n">delete_docs</span> <span class="o">=</span> <span class="p">[</span>
         <span class="n">Document</span><span class="p">(</span>
           <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;üê¶&#39;</span><span class="p">,</span>
           <span class="n">embedding</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
           <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;guardian&#39;</span><span class="p">:</span> <span class="s1">&#39;Vermilion Bird&#39;</span><span class="p">,</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;South&#39;</span><span class="p">}</span>
         <span class="p">),</span>
       <span class="p">]</span>

<span class="c1"># extract the document ids from the delete_docs list, and remove them</span>
<span class="c1"># from the search index</span>
<span class="n">doc_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">delete_docs</span><span class="p">]</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">delete_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">doc_ids</span><span class="p">]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_ids</span><span class="p">)</span>
</pre></div>
</div>
<p>The code above is written in such a way that the corresponding list of documents to be either updated or deleted can be easily extended without the need to change the existing Python code.</p>
<div class="section" id="expanding-size">
<h5>Expanding size<a class="headerlink" href="#expanding-size" title="Permalink to this headline">¬∂</a></h5>
<p>The update and delete operations use a masking underneath. This is done to maintain high performance overall. However, this means that old data will not be deleted, but will simply be masked as being deleted. Thus the size of the indexer on disk (and in memory) will grow over time the more update or delete operations you perform. We recommend setting the <code class="docutils literal notranslate"><span class="pre">delete_on_dump</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">NumpyIndexer</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>. When the Flow is shut down, the data that has been marked as deleted will be permanently deleted before being saved to disk. By default the parameter is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, as setting it to <code class="docutils literal notranslate"><span class="pre">True</span></code> will make the shut down process slower.</p>
</div>
</div>
<div class="section" id="runable-example">
<h4>Runable example<a class="headerlink" href="#runable-example" title="Permalink to this headline">¬∂</a></h4>
<p>You can run all the above code snippets on a hosted Jupyter Notebook by clicking <a class="reference external" href="https://mybinder.org/v2/gh/jina-ai/jupyter-notebooks/089947661673084eb26ef22b7870dc31199acdac">here</a></p>
</div>
</div>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¬∂</a></h2>
<p>Unfortunately there are some limitations to what Jina can do for the moment. These were trade-offs we needed to implement to keep Jina performant, robust, and easy to use. Some of these will be addressed in future versions, while some are intrinsic to Jina‚Äôs architecture.</p>
<ol>
<li><p><strong>Partial update</strong>
For the moment we do not support partial updates. So if you want to update a document, you need to send the entire document. This is due to Jina‚Äôs architecture: the document is sent as one piece through the Flow.</p></li>
<li><p><strong>Update flows</strong>
In the context of Flows with segmenters and chunks, a Document may end up being split into chunks. Currently, the Update request will not work for these. You will need to manually remove the chunks by their <code class="docutils literal notranslate"><span class="pre">ids</span></code>. Then you can remove the parent document as well, by its <code class="docutils literal notranslate"><span class="pre">id</span></code>. Finally, you can index the new document, with its new contents (and thus new, different child chunks).</p></li>
<li><p><strong>Sharding</strong>
When sharding data in indexers, the data will be split across these. This is achieved due to the <code class="docutils literal notranslate"><span class="pre">polling:</span> <span class="pre">any</span></code> configuration. During a query, you will need to set <code class="docutils literal notranslate"><span class="pre">polling:</span> <span class="pre">all</span></code>. However, this will lead to some shards getting a query request with a key that does not exist. In this case, warnings will be emitted by the indexer. You can ignore these within this context. The warnings are there for the situations when missing keys are <em>not</em> expected.</p></li>
<li><p><strong>Indexing while querying</strong>
The index, update, and delete operations cannot be executed within the same context as the query operation. This is due to the way flushing to disk works within the Flow and Executor context lifecycle. This is applicable across all VectorIndexers. Thus, you need to exit the Flow context when you want to switch from one set of operations to the other.</p>
<p>You can see this in the code listing at the beginning of this chapter.</p>
</li>
<li><p><strong>Compound Indexer</strong></p></li>
</ol>
<p>While using a <code class="docutils literal notranslate"><span class="pre">jtype:</span> <span class="pre">CompoundIndexer</span></code>, it is not possible to return embeddings to the next Driver in the Flow. This is because the <a class="reference external" href="https://github.com/jina-ai/jina/blob/master/jina/resources/executors.requests.CompoundIndexer.yml">jtype: CompoundIndexer</a> has an <code class="docutils literal notranslate"><span class="pre">jtype:</span> <span class="pre">ExcludeQL</span></code> for all the embeddings during <code class="docutils literal notranslate"><span class="pre">IndexRequest</span></code> and <code class="docutils literal notranslate"><span class="pre">UpdateRequest</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">jtype</span><span class="p">:</span> <span class="n">ExcludeQL</span>
      <span class="k">with</span><span class="p">:</span>
        <span class="n">fields</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">embedding</span>
</pre></div>
</div>
<p>This is done because otherwise the embeddings would be stored in the <code class="docutils literal notranslate"><span class="pre">BaseVectorIndexer</span></code> but also in the <code class="docutils literal notranslate"><span class="pre">BaseKVIndexer</span></code>.
If you want to be able to access the embeddings anyway, you can can overwrite it in your own <code class="docutils literal notranslate"><span class="pre">index.yml</span></code> and <code class="docutils literal notranslate"><span class="pre">query.yml</span></code> files removing the <code class="docutils literal notranslate"><span class="pre">jtype:</span> <span class="pre">ExcludeQL</span></code> directive.</p>
<p>The example of using <code class="docutils literal notranslate"><span class="pre">jtype:</span> <span class="pre">CompoundIndexer</span></code> without <code class="docutils literal notranslate"><span class="pre">jtype:</span> <span class="pre">ExcludeQL</span></code> can be seen <a class="reference external" href="https://docs.jina.ai/chapters/flow/#use-flow-api-in-yaml">here</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        
        <a href="../ranker/" class="btn btn-neutral float-right" title="A Guide to Jina Rankers"
           accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
        
        
        <a href="../input_output/" class="btn btn-neutral float-left" title="How to handle Inputs and Outputs for Flows"
           accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
        
    </div>
    

    <hr/>

    <div role="contentinfo">
        <nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">

            <ul class="devsite-footer-linkboxes-list">

                <li class="devsite-footer-linkbox ">
                    <h3 class="devsite-footer-linkbox-heading no-link">Stay connected</h3>
                    <ul class="devsite-footer-linkbox-list">

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">

                                <i class="fab fa-github"></i> GitHub

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://www.linkedin.com/company/jinaai/" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">

                                <i class="fab fa-linkedin"></i> LinkedIn

                            </a>

                        </li>



                        <li class="devsite-footer-linkbox-item">

                            <a href="https://twitter.com/JinaAI_" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">

                                <i class="fab fa-twitter"></i> Twitter

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://www.youtube.com/c/JinaAI" class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">

                                <i class="fab fa-youtube"></i> YouTube

                            </a>

                        </li>

                    </ul>
                </li>

                <li class="devsite-footer-linkbox ">
                    <h3 class="devsite-footer-linkbox-heading no-link">Support</h3>
                    <ul class="devsite-footer-linkbox-list">
                        <li class="devsite-footer-linkbox-item">

                            <a href="https://slack.jina.ai"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">

                                <i class="fab fa-slack"></i> Slack community

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina/issues"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">

                                Issue tracker

                            </a>

                        </li>

                        <li class="devsite-footer-linkbox-item">

                            <a href="https://github.com/jina-ai/jina/blob/master/CHANGELOG.md"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">

                                Release notes

                            </a>

                        </li>



                        <li class="devsite-footer-linkbox-item">

                            <a href="https://career.jina.ai"
                               class="devsite-footer-linkbox-link gc-analytics-event"
                               data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">

                                Career@Jina AI

                            </a>

                        </li>


                    </ul>
                </li>

            </ul>

        </nav>
        <p>
            
            &copy; Copyright Jina AI Limited. All rights reserved.
            <span class="lastupdated">
        Last updated on Apr 20, 2021.
      </span>

        </p>
    </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });

      function showhide_navbar() {
      var x = document.getElementsByClassName("wy-nav-side")[0];
      var y = document.getElementsByClassName("wy-nav-content-wrap")[0];
      var z = document.getElementById("showhide-navbar-btn");
      if (x.style.display === "none") {
        x.style.display = "block";
        y.style.marginLeft = "300px";
        z.style.left = "300px";
      } else {
        x.style.display = "none";
        y.style.marginLeft = "0";
        z.style.left = "0px";
      }
    }

  </script>

  <!-- Search box becomes active when you press the slash(/) key anywhere on the page-->
  <script>
    const body = document.querySelector('body');
    const searchBox = document.querySelector('form').querySelector('input[type="text"]');

    body.addEventListener('keyup', event => {
      event.preventDefault()
      if (event.key === '/') {
        searchBox.focus();
      }
    });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-164627626-3', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>